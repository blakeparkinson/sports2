function clearModal(){modal.find("#email-sender").val(""),modal.find("#email-recipients").val(""),modal.find("#message").val(""),$(this).removeData("bs.modal")}function appendMessage(e){if("undefined"!=typeof teamId&&"undefined"!=typeof team_name)var t="Try to beat my score of {{"+correct+"}} on this "+team_name+" quiz: https://www.rosterbliz.com?team_id=Qknb0gNGL1x";else var t="Thought you might enjoy some sports quizzes at rosterbliz.com.";modal.find("#message").val(t)}function sendEmail(e){var t=$(e.target),a=t.closest(".modal-content"),r=a.find("#email-sender").val(),o=a.find("#email-recipients").val(),n=a.find("textarea#message").val(),i={sender:$.trim(r),recipients:$.trim(o),subject:"Take this Quiz from Rosterblitz",text_body:$.trim(n),html_body:"<p>"+$.trim(n)+"</p>"},s=validateInputs(i);s||$.ajax({url:"teams/email",data:i,type:"get",dataType:"json",success:function(e){console.log("here")}}),$("#emailModal").modal("hide")}function validateInputs(e){var t=!1;if(e.sender.length<1||e.text_body.length<1)return t=!0;var a=e.recipients.split(",");for(i=0;i<a.length;i++)if(!validateEmail(a[i]))return t=!0;return t}function fetchPopupDimensions(){var e=window.innerWidth/2,t=window.innerHeight/2,a=void 0!=window.screenLeft?window.screenLeft:screen.left,r=void 0!=window.screenTop?window.screenTop:screen.top;width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var o=width/2-e/2+a,n=height/2-t/2+r,i={w:e,h:t,top:n,left:o};return i}function postSocial(e){var t=$(e.target),a=fetchPopupDimensions();title=t.closest(".social").hasClass("social-sidebar")?t.closest(".social-sidebar").data("title"):t.closest(".social-chart").data("title"),"twitter"==t.attr("id")?window.open("https://twitter.com/share?text="+title+"&url=www.espn.com","Share a quiz on twitter","scrollbars=yes, width="+a.w+", height="+a.h+", top="+a.top+", left="+a.left):window.open("https://www.facebook.com/dialog/feed?app_id=1600051886893474&redirect_uri=http://localhost:3000/auth/tweet&name=lahblahblah&display=popup&link="+window.location.href,"Share a quiz on twitter","scrollbars=yes, width="+a.w+", height="+a.h+", top="+a.top+", left="+a.left)}function openAuthPopup(){window.open("auth/twitter","Log in with Twitter","width=780,height=410,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0,left=500,top=800")}function openTweetPopup(){window.open("auth/tweet","Share on Twitter","width=780,height=410,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0,left=500,top=800")}function openFacebookAuthPopup(){window.open("auth/facebook","Log in with Facebook","width=780,height=410,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0,left=500,top=800")}function openFacebookPostPopup(){window.open("auth/posttofacebook","Share on Facebook","width=780,height=410,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0,left=500,top=800")}function closePopupAndRefreshPage(){}function fetchTrendingQuiz(e){var t=$(this).data("team-id"),a=$(this).data("type"),r={team_id:t,type:a,trending:!0};AjaxCreateQuiz(r)}function fetchQuiz(e){var t=($(e.target),$(".selected-team"));if(t.length){var a=t.data("api-team-id"),r=t.data("league"),o=t.data("type"),n=t.data("team-id");if(t.data("category"))var i=t.data("category");else var i=t.data("team");var s={api_team_id:a,league:r,team_id:n,team_name:i,type:o};AjaxCreateQuiz(s)}else $("#selectTeamModal").modal("show")}function AjaxCreateQuiz(e){var t=window.location.pathname.split("/");if(t.length>2)var a="../teams/quiz";else var a="teams/quiz";$.ajax({url:a,data:e,type:"get",dataType:"json",success:function(e){e.error?console.log("Throw an error popup or smething eventually"):window.location.href="../quiz?id="+e._id+"&team_id="+e.team_id+"&league="+e.league}}).done(function(){})}function compare(e,t){return e.total.games_started>t.total.games_started?-1:e.total.games_started<t.total.games_started?1:0}function validateEmail(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)}function getSpanColor(e){e/="nfl"==league?5:3;var t="#fff";switch(!0){case 1>e:t=lowHex;break;case e>=.1&&2>e:t=mlowHex;break;case e>=2&&3>e:t=medHex;break;case e>=3&&4>e:t=mhighHex;break;case e>=4&&5>e:t=highHex;break;case e>=5:t=shighHex}return t}function legend(e,t){legend(e,t,null)}function legend(e,t,a){e.className="legend";for(var r=t.hasOwnProperty("datasets")?t.datasets:t;e.hasChildNodes();)e.removeChild(e.lastChild);var o=a?noop:noop,n=document.createElement("div");n.className="legend-header",subheaderText=document.createTextNode("Players Guessed"),n.appendChild(subheaderText),e.appendChild(n),r.forEach(function(t,r){var n=document.createElement("div");n.className="title",e.appendChild(n);var i=document.createElement("div");i.className="color-sample",i.style.backgroundColor=t.hasOwnProperty("strokeColor")?t.strokeColor:t.color,i.style.borderColor=t.hasOwnProperty("fillColor")?t.fillColor:t.color,n.appendChild(i);var s=document.createTextNode(t.label);s.className="text-node",n.appendChild(s),o(a,n,r)})}function showTooltip(e,t,a){var r=Chart.helpers,o=e.segments;"undefined"!=typeof o&&(r.addEvent(t,"mouseover",function(){var t=o[a];t.save(),t.fillColor=t.highlightColor,e.showTooltip([t]),t.restore()}),r.addEvent(t,"mouseout",function(){e.draw()}))}function noop(){}function formatResult(e){if("roster"!=e.type)var t='<div id ="team-market">'+e.description+" </div>";else var t='<div id ="team-market">'+e.market+" "+e.name+" </div>";return t}function formatSelection(e){if("roster"!=e.type)var t='<p class="selected-team"  data-league= "'+e.league+'" data-type="'+e.type+'"data-id="'+e.id+'"data-team-id="'+e.team_id+'"> '+e.description+"</p>";else var t='<p class="selected-team" data-team="'+e.market+" "+e.name+'" data-league= "'+e.league+'" data-type="'+e.type+'"data-api-team-id="'+e.api_team_id+'"data-id="'+e.id+'"data-team-id="'+e.team_id+'"> '+e.market+" "+e.name+"</p>";return t}function formatNoMatches(e){var t="<p>You drunk?</p>";return t}$(document).ready(function(){$("body").on("click",'[data-action="pick-team"], .quiz-btn',fetchQuiz),$("body").on("click",".create-quiz",fetchTrendingQuiz),$("body").on("click",".twitter-login",openAuthPopup),$("body").on("click",".tweet",openTweetPopup),$("body").on("click",".facebook-login",openFacebookAuthPopup),$("body").on("click",".facebook-post",openFacebookPostPopup),$("body").on("click",".close-auth",closePopupAndRefreshPage),$("body").on("click",".post-social",postSocial),$("body").on("click","#email-btn",sendEmail),$("body").on("click",".close-window",function(){window.close()}),window.location.href.indexOf("auth")>-1&&setTimeout(function(){window.close()},2e3),$("body").on("hidden.bs.modal",".modal",clearModal),$("body").on("click",".email-img",appendMessage),$(document).keypress(function(e){var t=e.keyCode?e.keyCode:e.which;"13"==t&&$("#take-quiz-button").trigger("click")})});var modal=$(".modal"),formatRoster=function(e){var t=sortTeam(e),a=$("#team").html(),r=Handlebars.compile(a);return $(roster).empty().append(r(t)),t},sortTeam=function(e){return e.players.sort(compare),e};$("#copyright-date").text((new Date).getFullYear()),Handlebars.registerHelper("render_position",function(e,t){if(arguments.length<2)throw new Error("Handlerbars Helper 'render_position' needs 2 parameters");var t=t.toUpperCase();switch(e){case"nba":switch(t){case"G":t="Guard";break;case"F":t="Forward";break;case"C":t="Center";break;case"F-C":case"C-F":t="Forward/Center";break;case"G-F":case"F-G":t="Guard/Forward"}break;case"eu_soccer":switch(t){case"D":t="Defender";break;case"F":t="Forward";break;case"M":t="Midfielder";break;case"G":t="Goalie"}break;case"nhl":switch(t){case"D":t="Defender";break;case"C":t="Center";break;case"LW":t="Left Winger";break;case"RW":t="Right Winger";case"F":t="Forward";break;case"G":t="Goalie"}}return t}),Handlebars.registerHelper("format_height",function(e){if(!parseInt(e))return"";if(arguments.length<1)throw new Error("Handlerbars Helper 'format_height' needs 2 parameters");var t=Math.floor(e/12),a=e%12,r=t+"'"+a+'"';return r}),Handlebars.registerHelper("percentageCalc",function(e,t){if(arguments.length<1)throw new Error("Handlerbars Helper 'percentageCalc' needs 2 parameters");var a=t/e;return a=100*a,a=a.toFixed(1),isNaN(a)||10>a?a="N/A":a+="%",a}),Handlebars.registerHelper("abridgeSalary",function(e){if(arguments.length<1)throw new Error("Handlerbars Helper 'abridgeSalary' needs 1 parameter");if(console.log(e),void 0===e)var t="Not available";else{var a=e,a=a.replace("$",""),r=String(a);if(8===a.length)var o=r.charAt(0),n=r.charAt(1),i=r.charAt(2),t="$"+o+n+"."+i+"M";else if(7===a.length)var o=r.charAt(0),n=r.charAt(1),t="$"+o+"."+n+"M";else if(6===a.length)var o=r.charAt(0),n=r.charAt(1),i=r.charAt(2),t="$"+o+n+i+"K";else if(5===a.length)var o=r.charAt(0),n=r.charAt(1),t="$"+o+n+"K";else var t="Not available"}return t}),Handlebars.registerHelper("add_together",function(e,t){if(arguments.length<1)throw new Error("Handlerbars Helper 'add_together' needs 2 parameters");var a=e+t;return a}),Handlebars.registerHelper("pluralize",function(e,t,a){return 1===e?t:"string"==typeof a?a:t+"s"}),Handlebars.registerHelper("pluralCount",function(e,t,a){return Handlebars.helpers.pluralize.apply(this,arguments)}),$(function(){$('[data-toggle="tooltip"]').tooltip()}),$(function(){$('[data-toggle="popover"]').popover()});var roster,correct=0,placer=0,stop_counter=!1;team_container=$(".team-container"),answer_container=$(".answer-container-contain");var shighHex="#C56363",highHex="#FFAB45",mhighHex="#FFFF59",medHex="#B7CA85",mlowHex="#46BFBD",lowHex="#8C33B7";roster=void 0!=typeof roster?roster:[];var card=$(".player-card");$(document).ready(function(){console.log(roster);var e=$(".columns");e.on("keyup","#guess-box",fetchGuess),$("#guess-box").focus(),e.on("click",".quit-btn",endQuiz),e.on("click",".correct-guess:not('.no-flip')",showCard),$("#card").flip({trigger:"manual"}),e.on("mouseover",".inner-guess.guessed:not('.no-hover')",hoverCard),e.on("mouseout",".inner-guess.guessed",removeHover),$("#graphModal").modal({show:!1}),startCounter()});var hoverCard=function(){var e=answer_container.data("bhex"),t=answer_container.data("fhex");$(this).css({"background-color":e,color:t})},removeHover=function(){$(this).css({background:"inherit",color:"inherit"})},startCounter=function(){var e=$(".clock");if(e.length){var t=e.html(),a=t.split(":"),r=new Date;if(r.setHours(0),r.setMinutes(a[0]),r.setSeconds(a[1]),"00:00"!=t){var o=new Date(r.valueOf()-1e3),n=o.toTimeString().split(" "),i=n[0].split(":"),t=i[1]+":"+i[2];e.html(t),setTimeout(startCounter,1e3)}else{var s=team_container.find("#guess-box");s.prop("readonly",!0),stop_counter||endQuiz()}}},uploadScore=function(e){var t=QueryString(),a={quiz_id:t.id,league:t.league,quiz_score:e,possible_score:roster.length};$.ajax({url:"quiz/results",data:a,type:"get",dataType:"json",success:showGraphModal})},getLegendLabel=function(e){var t="";if("nfl"!=league)switch(e){case"shigh":t="15+";break;case"high":t="12-14";break;case"mhigh":t="9-11";break;case"med":t="6-8";break;case"mlow":t="3-5";break;case"low":t="2 or Fewer"}else switch(e){case"shigh":t="25+";break;case"high":t="20-24";break;case"mhigh":t="15-19";break;case"med":t="10-14";break;case"mlow":t="5-9";break;case"low":t="5 or Less"}return t},showGraphModal=function(e){e.correct=correct,e.team_name=team_name,e.logo_url=logo_url,e.shortPercentile=percentileEndingText(e.scores.percentile.toFixed(0)),e.labelColor=getSpanColor(correct),e.teamId=teamId;var t=$("#quiz-graph"),a=$("#graphModal");AppendTemplate(t,a,e,function(){$("#graphModal").modal("show"),$("#graphModal").on("shown.bs.modal",function(t){var r=[{value:e.scores.brackets.high,color:highHex,label:getLegendLabel("high")},{value:e.scores.brackets.mhigh,color:mhighHex,label:getLegendLabel("mhigh")},{value:e.scores.brackets.med,color:medHex,label:getLegendLabel("med")},{value:e.scores.brackets.mlow,color:mlowHex,label:getLegendLabel("mlow")},{value:e.scores.brackets.low,color:lowHex,label:getLegendLabel("low")}];roster.length>14&&r.unshift({value:e.scores.brackets.shigh,color:shighHex,label:getLegendLabel("shigh")});var o={segmentShowStroke:!0,percentageInnerCutout:65,showTooltips:!1,responsive:!0,animationSteps:100,animationEasing:"easeOutQuart"},n=(document.getElementById("chart"),document.getElementById("chart").getContext("2d")),i=new Chart(n).Doughnut(r,o);legend(document.getElementById("chartLegend"),r,i);new ZeroClipboard($("[data-clipboard-text]"));a.on("click",".share-this",activeCopyButton)})})},activeCopyButton=function(){$(this).text("Copied").addClass("copied")},fetchGuess=function(){var e=$(this).val().toLowerCase().trim(),t=$(event.target);e.length>2&&checkForMatches(e,t)},checkForMatches=function(e,t){_.each(roster,function(a,r){var o="",n="";void 0!=a.last_name?o=a.last_name:void 0!=a.full_last_name&&(o=a.full_last_name),void 0!=a.full_name?n=a.full_name:void 0!=a.full_first_name&&(n=a.full_first_name);var o=void 0!=a.last_name?a.last_name:a.full_last_name;e!=o.toLowerCase().trim()&&e!=n.toLowerCase().trim()||a.guessed||(appendGreenCheck(t),correct++,addToCorrectList(a,r),t.val(""),team_container.find(".number").html(correct),a.guessed=!0,correct==roster.length&&endQuiz(event,!0))})},appendGreenCheck=function(e){var t=e.closest(".form-group").find(".glyphicon");t.removeClass("hidden").show(),t.fadeOut(2e3)},addToCorrectList=function(e,t){if(1!=e.guessed){placer++;var a="";if("undefined"!=typeof e.avatar_url&&(a='<img class="circle-pic" src='+e.avatar_url+">"),"leaders"!=type&&"goats"!=type){var r='<div class="outer-guess"><div class="inner-guess"><div class="correct-guess" data-index="'+t+'">'+placer+"."+a+e.full_name+"</div></div></div>";answer_container.append(r);var o=answer_container.find('.correct-guess[data-index="'+t+'" ]').closest(".outer-guess");o.find(".inner-guess").addClass("guessed"),o.hide(),o.fadeIn(200).addClass("green-background")}else{if(e.stat<1)var n=100*e.stat,n=n.toFixed(1)+"%";else var n=e.stat;var i='<span class="stat">'+n+"</span>",s=answer_container.find(".correct-guess[data-player-id="+e.player_id+"]"),l=a+e.full_name;s.append(l),s.parent().append(i).addClass("guessed no-hover"),s.closest(".outer-guess").fadeIn(200).addClass("green-background")}}},populateTable=function(e,t){e.guessed||prepareCard(e)},showCard=function(e){var t=$(this).data("index");prepareCard(roster[t],!0)},prepareCard=function(e,t){var a="";e.full_name?a=e.full_name:e.first_name&&e.last_name?a=e.first_name+" "+e.last_name:e.full_first_name&&(a=e.full_first_name),e.team_name=team_name,e.league=league;var r=$("#full-card");AppendTemplate(r,card,e),$(card).on("click",".back-to-answer",function(){$("#card").flip(!1)}),t&&$("#card").flip(!0)},AppendTemplate=function(e,t,a,r){var e=e.html(),o=Handlebars.compile(e);t.empty();var n=o(a);t.append(n),r&&r()},endQuiz=function(e,t){if($("#also-might-like").show(),stop_counter=!0,team_container.find(".clock").text("00:00"),!t)for(var a=0;a<roster.length;a++)addToCorrectList(roster[a],a);team_container.find(".quit-btn").remove(),uploadScore(correct)},QueryString=function(){for(var e={},t=window.location.search.substring(1),a=t.split("&"),r=0;r<a.length;r++){var o=a[r].split("=");if("undefined"==typeof e[o[0]])e[o[0]]=o[1];else if("string"==typeof e[o[0]]){var n=[e[o[0]],o[1]];e[o[0]]=n}else e[o[0]].push(o[1])}return e},getTemplate=function(e,t,a){templates={},$.post("/index/get/"+e,t,function(r){return templates[e]=r,tpl=processTemplate(r,t,a),tpl})},processTemplate=function(e,t,a){var r,o=Handlebars.compile(e,a);return r=o(t?t:{})},percentileEndingText=function(e){var t=e%10,a="";switch(t){case 0:case 4:case 5:case 6:case 7:case 8:case 9:a="th";break;case 1:a="st";break;case 2:a="nd";break;case 3:a="rd"}return e+a};$(document).ready(function(){$("#select2").select2({width:"100%",placeholder:"Search a Team...",minimumInputLength:2,ajax:{url:"teams/team",dataType:"json",data:function(e,t){return{q:e,page_limit:10}},results:function(e,t){var a=[];return _.each(e,function(e){void 0==e.name&&(e.name=""),void 0!=e.category&&(e.market=e.category,e._id=e.team_id),a.push({id:e._id,market:e.market,name:e.name,api_team_id:e.api_team_id,team_id:e.team_id,type:e.type,league:e.league,description:e.description})}),{results:a}}},formatResult:formatResult,formatNoMatches:formatNoMatches,formatSelection:formatSelection})});